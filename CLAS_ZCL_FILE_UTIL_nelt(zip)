<?xml version="1.0" encoding="utf-16"?>
<CLAS CLSNAME="ZCL_FILE_UTIL" VERSION="1" LANGU="E" DESCRIPT="File util" UUID="0050568000071ED3A7F22A7DC9B3E3CC" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" AUTHOR="DRIGER" CREATEDON="20120131" CHANGEDON="00000000" CHGDANYON="00000000" CLSFINAL="X" CLSCCINCL="X" FIXPT="X" UNICODE="X" R3RELEASE="730" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 ">
 <publicSection>CLASS zcl_file_util DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.
*&quot;* public components of class ZCL_FILE_UTIL
*&quot;* do not include other source files here!!!

    CONSTANTS file_name TYPE file_name VALUE &apos;type template&apos;. &quot;#EC NOTEXT
    CLASS-DATA mf_separator TYPE char1 .

    CLASS-METHODS class_constructor .
    TYPE-POOLS abap .
    CLASS cl_abap_char_utilities DEFINITION LOAD .
    CLASS-METHODS read_pc
      IMPORTING
        !if_fname TYPE csequence
        !if_codepage TYPE abap_encoding DEFAULT &apos;1404&apos;
        !if_delimiter TYPE char1 DEFAULT cl_abap_char_utilities=&gt;horizontal_tab
      EXPORTING
        !et_data TYPE STANDARD TABLE
      EXCEPTIONS
        error .
    CLASS-METHODS read_as
      IMPORTING
        !if_fname TYPE csequence
        !if_delimiter TYPE char1 DEFAULT cl_abap_char_utilities=&gt;horizontal_tab
        !if_codepage TYPE abap_encoding DEFAULT &apos;1404&apos;
      EXPORTING
        !et_data TYPE STANDARD TABLE
      EXCEPTIONS
        error .
    CLASS-METHODS save_pc
      IMPORTING
        !if_fname TYPE csequence
        !it_data TYPE STANDARD TABLE
        !if_codepage TYPE abap_encoding DEFAULT &apos;1404&apos;
        !if_delimiter TYPE char1 DEFAULT cl_abap_char_utilities=&gt;horizontal_tab
      EXCEPTIONS
        error .
    CLASS-METHODS save_as
      IMPORTING
        !if_fname TYPE csequence
        !it_data TYPE STANDARD TABLE
        !if_codepage TYPE abap_encoding DEFAULT &apos;1404&apos;
        !if_delimiter TYPE char1 DEFAULT cl_abap_char_utilities=&gt;horizontal_tab
      EXCEPTIONS
        error .
    CLASS-METHODS f4_pc
      EXPORTING
        value(ef_fname) TYPE csequence .
    CLASS-METHODS f4_as
      EXPORTING
        !ef_fname TYPE csequence .
    CLASS-METHODS ls_pc
      IMPORTING
        !if_path TYPE csequence
      EXPORTING
        !et_files TYPE STANDARD TABLE .
    CLASS-METHODS ls_as
      IMPORTING
        !if_path TYPE csequence
      EXPORTING
        value(et_files) TYPE STANDARD TABLE .
    CLASS-METHODS convert_in
      IMPORTING
        !if_value TYPE data
      EXPORTING
        !ef_value TYPE data
      EXCEPTIONS
        error .
    CLASS-METHODS read_pc_xls
      IMPORTING
        !im_fname TYPE localfile
        !im_conversion TYPE xfeld
      EXPORTING
        !et_table TYPE STANDARD TABLE
      EXCEPTIONS
        error .
    CLASS-METHODS delimit_tab
      IMPORTING
        !it_data TYPE STANDARD TABLE
        !reverse TYPE abap_bool DEFAULT &apos;X&apos;
        !if_delimiter TYPE char1 DEFAULT cl_abap_char_utilities=&gt;horizontal_tab
      EXPORTING
        value(et_data) TYPE STANDARD TABLE
      EXCEPTIONS
        error .
    CLASS-METHODS delimit_struc
      IMPORTING
        !is_data TYPE data
        !reverse TYPE abap_bool DEFAULT &apos;X&apos;
        !if_delimiter TYPE char1 DEFAULT cl_abap_char_utilities=&gt;horizontal_tab
        !if_shift TYPE int2 DEFAULT 0
      EXPORTING
        !es_data TYPE data
      EXCEPTIONS
        error .
    CLASS-METHODS archive_as
      IMPORTING
        !if_source TYPE csequence
        !if_target TYPE csequence
      EXCEPTIONS
        error .
    CLASS-METHODS fname
      IMPORTING
        !if_path TYPE csequence
      RETURNING
        value(re_fname) TYPE file_name .
    CLASS-METHODS copy_as
      IMPORTING
        !if_source TYPE csequence
        !if_target TYPE csequence
        !if_fname TYPE csequence OPTIONAL
      EXPORTING
        !ef_source TYPE csequence
        !ef_target TYPE csequence
      EXCEPTIONS
        error .
    CLASS-METHODS read_pc_xls1
      IMPORTING
        !im_fname TYPE localfile
        !im_conversion TYPE xfeld
        !im_line_header TYPE char01 OPTIONAL
      EXPORTING
        !et_table TYPE STANDARD TABLE
      EXCEPTIONS
        error .
    CLASS-METHODS read_pc_xls2
      IMPORTING
        !im_fname TYPE csequence
        !im_conversion TYPE xfeld DEFAULT &apos;X&apos;
        !im_header TYPE int1 DEFAULT 0
        !im_sheet TYPE int1 DEFAULT 0
      EXPORTING
        !et_table TYPE STANDARD TABLE
      EXCEPTIONS
        error .
    CLASS-METHODS save_zip_as
      IMPORTING
        !if_fname TYPE csequence
      EXPORTING
        !ef_xstr TYPE xstring
      EXCEPTIONS
        error .
    CLASS-METHODS save_zip_pc
      IMPORTING
        !if_fname TYPE csequence
      EXPORTING
        !ef_xstr TYPE xstring
      EXCEPTIONS
        error .
    CLASS-METHODS add_zip
      IMPORTING
        !if_fname TYPE csequence
        !it_data TYPE STANDARD TABLE
        !if_codepage TYPE abap_encoding DEFAULT &apos;1404&apos;
        !if_delimiter TYPE char1 DEFAULT cl_abap_char_utilities=&gt;horizontal_tab
      EXCEPTIONS
        error .</publicSection>
 <protectedSection>PROTECTED SECTION.
*&quot;* protected components of class ZCL_FILE_UTIL
*&quot;* do not include other source files here!!!

    CLASS-DATA mf_dummy TYPE string .
    CLASS-DATA mr_zip TYPE REF TO cl_abap_zip .
*&quot;* private components of class ZCL_FILE_UTIL
*&quot;* do not include other source files here!!!</protectedSection>
 <privateSection>PRIVATE SECTION.</privateSection>
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <typeUsage CLSNAME="ZCL_FILE_UTIL" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <attribute CLSNAME="ZCL_FILE_UTIL" CMPNAME="FILE_NAME" VERSION="1" LANGU="E" DESCRIPT="File name" EXPOSURE="2" STATE="1" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" ATTDECLTYP="2" ATTVALUE="&apos;type template&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="FILE_NAME" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_FILE_UTIL" CMPNAME="MF_DUMMY" VERSION="1" LANGU="E" EXPOSURE="1" STATE="1" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" ATTDECLTYP="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_FILE_UTIL" CMPNAME="MF_SEPARATOR" VERSION="1" LANGU="E" DESCRIPT="Single-Character Indicator" EXPOSURE="2" STATE="1" EDITORDER="2 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" ATTDECLTYP="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CHAR1" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_FILE_UTIL" CMPNAME="MR_ZIP" VERSION="1" LANGU="E" DESCRIPT="Zip Utility" EXPOSURE="1" STATE="1" EDITORDER="2 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" ATTDECLTYP="1" ATTEXPVIRT="0" TYPTYPE="3" TYPE="CL_ABAP_ZIP" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="ADD_ZIP" VERSION="1" LANGU="E" DESCRIPT="Add to zip package" EXPOSURE="2" STATE="1" EDITORDER="21 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="ADD_ZIP" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="ADD_ZIP" SCONAME="IT_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="ADD_ZIP" SCONAME="IF_CODEPAGE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_ENCODING" PARVALUE="&apos;1404&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="ADD_ZIP" SCONAME="IF_DELIMITER" VERSION="1" LANGU="E" DESCRIPT="Single-Character Flag" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="ADD_ZIP" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD add_zip.
    DATA: lf_str TYPE string,
        lf_xtr TYPE xstring,
        lf_siz TYPE int1,
        lt_bin TYPE solix_tab,
        lr_zip TYPE REF TO cl_abap_zip,
        lt_data TYPE TABLE OF char1024.
    FIELD-SYMBOLS: &lt;bin&gt; LIKE LINE OF lt_bin,
                   &lt;data&gt; LIKE LINE OF lt_data.

    zcl_file_util=&gt;delimit_tab( EXPORTING it_data = it_data
                                          reverse = abap_false
                                          if_delimiter = if_delimiter
                                IMPORTING et_data = lt_data ).

    LOOP AT lt_data ASSIGNING &lt;data&gt;.
      IF sy-tabix = 1.
        lf_str = &lt;data&gt;.
      ELSE.
        CONCATENATE lf_str &lt;data&gt; INTO lf_str
          SEPARATED BY cl_abap_char_utilities=&gt;cr_lf.
      ENDIF.
    ENDLOOP.

    CALL FUNCTION &apos;SCMS_STRING_TO_XSTRING&apos;
      EXPORTING
        text     = lf_str
*       MIMETYPE = &apos; &apos;
        encoding = if_codepage
      IMPORTING
        buffer   = lf_xtr
      EXCEPTIONS
        failed   = 1
        OTHERS   = 2.
    IF sy-subrc &lt;&gt; 0.
* Implement suitable error handling here
    ENDIF.

    IF mr_zip IS NOT BOUND.
      CREATE OBJECT mr_zip.
    ENDIF.
    lf_str  = if_fname.
    mr_zip-&gt;add(  name    = lf_str
                  content = lf_xtr ).
  ENDMETHOD.                    &quot;add_zip</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="ARCHIVE_AS" VERSION="1" LANGU="E" DESCRIPT="Archive from AS to AS" EXPOSURE="2" STATE="1" EDITORDER="14 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="ARCHIVE_AS" SCONAME="IF_SOURCE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="ARCHIVE_AS" SCONAME="IF_TARGET" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="ARCHIVE_AS" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD archive_as.
    copy_as( EXPORTING if_source = if_source
                       if_target = if_target
             EXCEPTIONS error = 4 ).
    IF sy-subrc &lt;&gt; 0.
      RAISE error.
    ENDIF.

    DELETE DATASET if_source.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE e287(oa) WITH if_source RAISING error.
    ENDIF.
  ENDMETHOD.                    &quot;ARCHIVE_AS</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="CLASS_CONSTRUCTOR" VERSION="1" LANGU="E" DESCRIPT="CLASS_CONSTRUCTOR" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="2" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD class_constructor.
    CASE sy-opsys.
      WHEN &apos;Windows NT&apos;.
        mf_separator = &apos;\&apos;.
      WHEN OTHERS.
        mf_separator = &apos;/&apos;.
    ENDCASE.
  ENDMETHOD.                    &quot;CLASS_CONSTRUCTOR</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="CONVERT_IN" VERSION="1" LANGU="E" DESCRIPT="Convert according to type" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="CONVERT_IN" SCONAME="IF_VALUE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DATA"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="CONVERT_IN" SCONAME="EF_VALUE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="DATA"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="CONVERT_IN" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD convert_in.
    DATA: lf_type  TYPE c,
          lf_point TYPE c,
          lf_minus TYPE c,
          lf_value TYPE string.
* RTTY
    DATA: lr_data  TYPE REF TO data.
    DATA: lt_ddic  TYPE TABLE OF x031l,
          lf_cexit TYPE char30.
    DATA: lr_descr TYPE REF TO cl_abap_datadescr.
    FIELD-SYMBOLS &lt;ddic&gt; LIKE LINE OF lt_ddic.

    lf_value = if_value.
* trim cr_lf
    REPLACE ALL OCCURRENCES OF cl_abap_char_utilities=&gt;cr_lf(1) IN lf_value WITH &apos;&apos;.
    REPLACE ALL OCCURRENCES OF cl_abap_char_utilities=&gt;cr_lf+1(1) IN lf_value WITH &apos;&apos;.
    CONDENSE lf_value.

* Converion exit from dictionarys
    lr_descr ?= cl_abap_datadescr=&gt;describe_by_data( ef_value ).
    IF lr_descr-&gt;is_ddic_type( ) = abap_true.
      lt_ddic = lr_descr-&gt;get_ddic_object( ).
      READ TABLE lt_ddic ASSIGNING &lt;ddic&gt; INDEX 1.
      IF sy-subrc = 0 AND &lt;ddic&gt;-convexit IS NOT INITIAL.
        CONCATENATE &apos;CONVERSION_EXIT_&apos; &lt;ddic&gt;-convexit &apos;_INPUT&apos; INTO lf_cexit.
        CALL FUNCTION lf_cexit
          EXPORTING
            input  = lf_value
          IMPORTING
            output = ef_value
          EXCEPTIONS
            OTHERS = 2.
        IF sy-subrc &lt;&gt; 0.
          RAISE error.
        ELSE.
          RETURN.  &quot;
        ENDIF.
      ENDIF.
    ENDIF.

* Other custom conversions
    DESCRIBE FIELD ef_value TYPE lf_type.
    CASE lf_type.
      WHEN &apos;P&apos;.
        &quot;match minus sign at start of string or at end
        FIND REGEX &apos;^(-)|(-)$&apos; IN lf_value SUBMATCHES lf_minus lf_minus.
        &quot;match last decimal sign to determin decimal point
        FIND REGEX &apos;([.,])[\d]*$&apos; IN lf_value SUBMATCHES lf_point.
        CASE lf_point.
          WHEN &apos;.&apos;.
            REPLACE ALL OCCURRENCES OF REGEX &apos;[,-]&apos; IN lf_value WITH &apos;&apos;.
          WHEN &apos;,&apos;.
            REPLACE ALL OCCURRENCES OF REGEX &apos;[.-]&apos; IN lf_value WITH &apos;&apos;.
            REPLACE ALL OCCURRENCES OF &apos;,&apos; IN lf_value WITH &apos;.&apos;.
        ENDCASE.
        TRY.
            ef_value = lf_value.
          CATCH cx_sy_conversion_no_number.
            MESSAGE e007(fes) INTO mf_dummy.
            RAISE error.
        ENDTRY.
        IF lf_minus = &apos;-&apos;.
          MULTIPLY ef_value BY -1.
        ENDIF.
      WHEN &apos;D&apos;.
        TRY.
            cl_abap_datfm=&gt;conv_date_ext_to_int(
              EXPORTING
                im_datext    = if_value
              IMPORTING
                ex_datint    = ef_value ).
          CATCH cx_abap_datfm_no_date .
          CATCH cx_abap_datfm_invalid_date .
          CATCH cx_abap_datfm_format_unknown .
          CATCH cx_abap_datfm_ambiguous .
            MESSAGE e007(fes) INTO mf_dummy.
            RAISE error.
        ENDTRY.
*    WHEN &apos;N&apos;.
*      CALL FUNCTION &apos;CONVERSION_EXIT_ALPHA_INPUT&apos;
*        EXPORTING
*          input  = if_value
*        IMPORTING
*          output = ef_value.
      WHEN OTHERS.
        ef_value = if_value.
    ENDCASE.
  ENDMETHOD.                    &quot;CONVERT_IN</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="COPY_AS" VERSION="1" LANGU="E" DESCRIPT="Copy file on Application Server" EXPOSURE="2" STATE="1" EDITORDER="16 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="COPY_AS" SCONAME="IF_SOURCE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="COPY_AS" SCONAME="IF_TARGET" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="COPY_AS" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="COPY_AS" SCONAME="EF_SOURCE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="COPY_AS" SCONAME="EF_TARGET" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="COPY_AS" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD copy_as.
    DATA: lf_source TYPE string,
          lf_target TYPE string,
          lf_fname  TYPE string.

    IF if_fname IS NOT SUPPLIED.
      FIND REGEX &apos;([^\\/]*)$&apos; IN if_source SUBMATCHES lf_fname.
      lf_source = if_source.
    ELSE.
      lf_fname = if_fname.
      CONCATENATE if_source lf_fname INTO lf_source SEPARATED BY mf_separator.
    ENDIF.
    CONCATENATE if_target lf_fname INTO lf_target SEPARATED BY mf_separator.
    REPLACE ALL OCCURRENCES OF REGEX &apos;[\\/]{2,}&apos; IN lf_source WITH mf_separator.
    REPLACE ALL OCCURRENCES OF REGEX &apos;[\\/]{2,}&apos; IN lf_target WITH mf_separator.
    CHECK lf_source &lt;&gt; lf_target.
*  CALL FUNCTION &apos;ARCHIVFILE_SERVER_TO_SERVER&apos;
*    EXPORTING
*      sourcepath       = lf_source
*      targetpath       = lf_target
*    EXCEPTIONS
*      error_file       = 1
*      no_authorization = 2
*      OTHERS           = 3.
*  IF sy-subrc &lt;&gt; 0.
*    RAISE error.
*  ENDIF.
*&quot;----------------------------------------------------------------------
*&quot;*&quot;Local Interface:
*&quot;  IMPORTING
*&quot;     VALUE(SOURCEPATH) LIKE  SAPB-SAPPFAD
*&quot;     VALUE(TARGETPATH) LIKE  SAPB-SAPPFAD DEFAULT SPACE
*&quot;  EXPORTING
*&quot;     VALUE(LENGTH) LIKE  SAPB-LENGTH
*&quot;  EXCEPTIONS
*&quot;      ERROR_FILE
*&quot;      NO_AUTHORIZATION
*&quot;----------------------------------------------------------------------
    DATA: BEGIN OF int_file,
           line(1000)  TYPE x,
          END OF int_file.
    DATA:
          lt_file LIKE TABLE OF int_file,
          ilength      TYPE p,
          count_table  TYPE p,
          line         LIKE int_file-line,
          bin_filesize TYPE p.
    &quot;data: afilename like authb-filename.
    FIELD-SYMBOLS: &lt;f1&gt; TYPE any.
***  afilename = sourcepath.
***  CALL FUNCTION &apos;AUTHORITY_CHECK_DATASET&apos;
***    EXPORTING
***      activity         = sabc_act_read
***      filename         = afilename
***    EXCEPTIONS
***      no_authority     = 1
***      activity_unknown = 2.
***  if sy-subrc &lt;&gt; 0.
***    message I046 raising NO_AUTHORIZATION.
***  endif.
* Öffnen File auf dem Applikationsserver
    OPEN DATASET lf_source FOR INPUT
                      IN BINARY MODE.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE e414(oa) WITH lf_source RAISING error.
    ENDIF.
* read in Information File
    REFRESH lt_file. &quot;int_file.
    bin_filesize = 0.
    DO.
      READ DATASET lf_source INTO int_file LENGTH ilength.
      IF sy-subrc = 0.
        APPEND int_file TO lt_file.
        bin_filesize = bin_filesize + ilength.
      ELSE.
        IF sy-subrc = 8.
* open of file failed
          MESSAGE e414(oa) WITH lf_source RAISING error.
        ELSE.
* end of file reached
          APPEND int_file TO lt_file.
          bin_filesize = bin_filesize + ilength.
          EXIT.
        ENDIF.
      ENDIF.
    ENDDO.
* close file on application server
    CLOSE DATASET lf_source.
* correct content of last line
    DESCRIBE TABLE lt_file LINES count_table.
    IF count_table &lt;&gt; 0.
      READ TABLE lt_file INDEX count_table INTO int_file.
      CLEAR line.
      IF ilength &gt; 0.
        ASSIGN int_file-line(ilength) TO &lt;f1&gt;.
        line = &lt;f1&gt;.
      ELSE.
        CLEAR line.
      ENDIF.
      CLEAR int_file-line.
      int_file-line = line.
      MODIFY lt_file FROM int_file INDEX count_table.
    ENDIF.
***  afilename = targetpath.
***  CALL FUNCTION &apos;AUTHORITY_CHECK_DATASET&apos;
***    EXPORTING
***      activity         = sabc_act_write
***      filename         = afilename
***    EXCEPTIONS
***      no_authority     = 1
***      activity_unknown = 2.
***  if sy-subrc &lt;&gt; 0.
***    message I046 raising NO_AUTHORIZATION.
***  endif.
* transfer to targetfile
* open file on application server
    OPEN DATASET lf_target FOR OUTPUT
                      IN BINARY MODE.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE e415(oa) WITH lf_source space RAISING error.
    ENDIF.
* correction content of lat line
    DESCRIBE TABLE lt_file LINES count_table.
    ilength = bin_filesize MOD 1000.
* Length file
    &quot;length = bin_filesize.
* write to file
    LOOP AT lt_file INTO int_file.
      IF sy-tabix &lt;&gt; count_table.
        TRANSFER int_file TO lf_target.
      ELSE.
        TRANSFER int_file TO lf_target LENGTH ilength.
      ENDIF.
      IF sy-subrc &lt;&gt; 0.
        MESSAGE e415(oa) WITH lf_target space RAISING error.
      ENDIF.
    ENDLOOP.
* close file on application server
    CLOSE DATASET lf_target.
    IF ef_source IS REQUESTED.
      ef_source = lf_source.
    ENDIF.
    IF ef_target IS REQUESTED.
      ef_target = lf_target.
    ENDIF.
  ENDMETHOD.                    &quot;COPY_AS</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_STRUC" VERSION="1" LANGU="E" DESCRIPT="Structure to delimited string line or reverse" EXPOSURE="2" STATE="1" EDITORDER="13 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_STRUC" SCONAME="IS_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DATA"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_STRUC" SCONAME="REVERSE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_STRUC" SCONAME="IF_DELIMITER" VERSION="1" LANGU="E" DESCRIPT="Single-Character Flag" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_STRUC" SCONAME="IF_SHIFT" VERSION="1" LANGU="E" DESCRIPT="Fill target struc from column [if_shift]" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT2" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_STRUC" SCONAME="ES_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="DATA"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_STRUC" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD delimit_struc.
    FIELD-SYMBOLS:
     &lt;wa_str&gt; TYPE string,
     &lt;val&gt; TYPE any.
    DATA:
      it_str TYPE TABLE OF string,
      lf_typ   TYPE c,
      lf_cnt   TYPE i.


* delimit -&gt; struct
    IF reverse = abap_true.
* no delimiting if output structure has no fields
      DESCRIBE FIELD es_data TYPE lf_typ COMPONENTS lf_cnt.
      IF lf_cnt = 0.
        convert_in( EXPORTING if_value = is_data
                    IMPORTING ef_value = es_data
                    EXCEPTIONS error = 4 ).
        IF sy-subrc &lt;&gt; 0.
          MESSAGE e007(fes) INTO mf_dummy.
          RAISE error.
        ENDIF.
        RETURN.
      ENDIF.
* split
      SPLIT is_data AT if_delimiter INTO TABLE it_str.
      LOOP AT it_str ASSIGNING &lt;wa_str&gt;.
        lf_cnt = sy-tabix + if_shift.
        ASSIGN COMPONENT lf_cnt OF STRUCTURE es_data TO &lt;val&gt;.
        CHECK sy-subrc = 0.
        convert_in( EXPORTING if_value = &lt;wa_str&gt;
                    IMPORTING ef_value = &lt;val&gt;
                    EXCEPTIONS error = 4 ).
        IF sy-subrc &lt;&gt; 0.
          MESSAGE e007(fes) INTO mf_dummy.
          RAISE error.
        ENDIF.
      ENDLOOP.
* struct -&gt; delimit
    ELSE.
      DESCRIBE FIELD is_data TYPE lf_typ COMPONENTS lf_cnt.
      IF lf_cnt = 0.
        es_data = is_data.
      ELSE.
        WHILE sy-subrc = 0.
          ASSIGN COMPONENT sy-index OF STRUCTURE is_data TO &lt;val&gt;.
          CHECK sy-subrc = 0.
          IF sy-index = 1.
            es_data = &lt;val&gt;.
          ELSE.
            CONCATENATE es_data if_delimiter &lt;val&gt; INTO es_data.
          ENDIF.
        ENDWHILE.
      ENDIF.
    ENDIF.

  ENDMETHOD.                    &quot;DELIMIT_STRUC</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_TAB" VERSION="1" LANGU="E" DESCRIPT="Structured table to delimited string table or reverse" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_TAB" SCONAME="IT_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_TAB" SCONAME="REVERSE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_TAB" SCONAME="IF_DELIMITER" VERSION="1" LANGU="E" DESCRIPT="Single-Character Flag" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_TAB" SCONAME="ET_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="0" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="DELIMIT_TAB" SCONAME="ERROR" VERSION="1" LANGU="E" DESCRIPT="Error" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD delimit_tab.
    FIELD-SYMBOLS: &lt;in&gt;  TYPE any,
                   &lt;out&gt; TYPE any.

    LOOP AT it_data ASSIGNING &lt;in&gt;.
      APPEND INITIAL LINE TO et_data ASSIGNING &lt;out&gt;.
      delimit_struc( EXPORTING is_data = &lt;in&gt;
                               reverse = reverse
                               if_delimiter = if_delimiter
                     IMPORTING es_data = &lt;out&gt;
                     EXCEPTIONS error = 4 ).
      IF sy-subrc &lt;&gt; 0.
        RAISE error.
      ENDIF.
    ENDLOOP.

  ENDMETHOD.                    &quot;DELIMIT_TAB</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="F4_AS" VERSION="1" LANGU="E" DESCRIPT="Select file form Application Server" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="F4_AS" SCONAME="EF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <source>METHOD f4_as.
    DATA: lf_path TYPE dxlpath,
          lf_abend_flag TYPE dxxabend.
    CALL FUNCTION &apos;F4_DXFILENAME_TOPRECURSION&apos;
      EXPORTING
        i_location_flag       = &apos;A&apos;
        i_server              = &apos; &apos;
      IMPORTING
        o_path                = lf_path
        abend_flag            = lf_abend_flag
      EXCEPTIONS
        communication_failure = 1
        system_failure        = 2
        rfc_error             = 3.
    ef_fname = lf_path.
  ENDMETHOD.                    &quot;F4_AS</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="F4_PC" VERSION="1" LANGU="E" DESCRIPT="Select file from PC" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="F4_PC" SCONAME="EF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="0" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <source>METHOD f4_pc.
    DATA: lf_file TYPE string.
    CALL METHOD cl_salv_test_data=&gt;select_file
      IMPORTING
        filename = lf_file.
    ef_fname = lf_file.
  ENDMETHOD.                    &quot;F4_PC</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="FNAME" VERSION="1" LANGU="E" DESCRIPT="Trim fname from path" EXPOSURE="2" STATE="1" EDITORDER="15 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="FNAME" SCONAME="IF_PATH" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="FNAME" SCONAME="RE_FNAME" VERSION="1" LANGU="E" DESCRIPT="File name" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="FILE_NAME"/>
  <source>METHOD fname.
****  FIND REGEX &apos;([^\\/]*)$&apos; IN if_path SUBMATCHES re_fname.
  ENDMETHOD.                    &quot;FNAME</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="LS_AS" VERSION="1" LANGU="E" DESCRIPT="List files in folder form Application Server" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="LS_AS" SCONAME="IF_PATH" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="LS_AS" SCONAME="ET_FILES" VERSION="1" LANGU="E" DESCRIPT="Directory of Files" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="0" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <source>METHOD ls_as.
    DATA: lf_path TYPE salfile-longname,
          lt_salf TYPE TABLE OF salfldir.
    FIELD-SYMBOLS: &lt;salf&gt; LIKE LINE OF lt_salf,
                   &lt;file&gt; TYPE data.

    lf_path = if_path.
****  REPLACE REGEX &apos;[\\/][\s]*$&apos; IN lf_path WITH &apos;&apos;. &quot;trim separator from end of path
    CALL FUNCTION &apos;RZL_READ_DIR_LOCAL&apos;
      EXPORTING
        name           = lf_path
      TABLES
        file_tbl       = lt_salf
      EXCEPTIONS
        argument_error = 1
        not_found      = 2
        OTHERS         = 3.
    IF sy-subrc &lt;&gt; 0.
*    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
*            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.

    LOOP AT lt_salf ASSIGNING &lt;salf&gt;.
      APPEND INITIAL LINE TO et_files ASSIGNING &lt;file&gt;.
      CHECK sy-subrc = 0.
      CONCATENATE lf_path mf_separator &lt;salf&gt;-name INTO &lt;file&gt;.
      CONDENSE &lt;file&gt;.
    ENDLOOP.

  ENDMETHOD.                    &quot;LS_AS</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="LS_PC" VERSION="1" LANGU="E" DESCRIPT="List files in folder from PC" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="LS_PC" SCONAME="IF_PATH" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="LS_PC" SCONAME="ET_FILES" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <source>METHOD ls_pc.
    DATA: lf_dir TYPE string,
          lf_count TYPE i.

    lf_dir = if_path.
    CALL METHOD cl_gui_frontend_services=&gt;directory_list_files
      EXPORTING
        directory                   = lf_dir
*       filter                      = &apos;*.*&apos;
        files_only                  = abap_true
      CHANGING
        file_table                  = et_files
        count                       = lf_count
      EXCEPTIONS
        cntl_error                  = 1
        directory_list_files_failed = 2
        wrong_parameter             = 3
        error_no_gui                = 4
        not_supported_by_gui        = 5
        OTHERS                      = 6.
    IF sy-subrc &lt;&gt; 0.
*   MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*              WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

  ENDMETHOD.                    &quot;LS_PC</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_AS" VERSION="1" LANGU="E" DESCRIPT="Read file to internal table form Application Server" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_AS" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_AS" SCONAME="IF_DELIMITER" VERSION="1" LANGU="E" DESCRIPT="Single-Character Flag" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_AS" SCONAME="IF_CODEPAGE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_ENCODING" PARVALUE="&apos;1404&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_AS" SCONAME="ET_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_AS" SCONAME="ERROR" VERSION="1" LANGU="E" DESCRIPT="Error" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD read_as.
    DATA: lf_line TYPE string,
          lr_data TYPE REF TO data,
          lf_fname TYPE string,
          ls_text  TYPE string,
          lr_ex    TYPE REF TO cx_root.
    FIELD-SYMBOLS: &lt;data&gt; TYPE any.

    lf_fname = if_fname.

    TRY.
        OPEN DATASET if_fname FOR INPUT IN LEGACY TEXT MODE CODE PAGE if_codepage.
      CATCH  cx_root INTO lr_ex.
        ls_text = lr_ex-&gt;get_text( ).
        MESSAGE e001(fes) WITH ls_text INTO mf_dummy.
        RAISE error.
    ENDTRY.

*  TRY.
*    OPEN DATASET if_fname ENCODING DEFAULT FOR INPUT IN TEXT MODE.
*  CATCH  cx_root INTO lr_ex.
*    ls_text = lr_ex-&gt;get_text( ).
*    MESSAGE e001(fes) WITH ls_text INTO mf_dummy.
*    RAISE error.
*  ENDTRY.

    IF sy-subrc &lt;&gt; 0.
      MESSAGE e001(fes) INTO mf_dummy.
      RAISE error.
    ENDIF.

    CREATE DATA lr_data LIKE LINE OF et_data.
    ASSIGN lr_data-&gt;* TO &lt;data&gt;.

    DO.
      READ DATASET if_fname INTO lf_line.
      IF sy-subrc = 0.
        &quot;split at tab
        delimit_struc( EXPORTING is_data = lf_line
                        IMPORTING es_data = &lt;data&gt; ).
        APPEND &lt;data&gt; TO et_data.
      ELSE.
        EXIT.
      ENDIF.
    ENDDO.
    CLOSE DATASET lf_fname.
  ENDMETHOD.                    &quot;READ_AS</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC" VERSION="1" LANGU="E" DESCRIPT="Read file to internal table from PC" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC" SCONAME="IF_CODEPAGE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_ENCODING" PARVALUE="&apos;1404&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC" SCONAME="IF_DELIMITER" VERSION="1" LANGU="E" DESCRIPT="Single-Character Flag" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC" SCONAME="ET_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC" SCONAME="ERROR" VERSION="1" LANGU="E" DESCRIPT="Error" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD read_pc.
    DATA: lf_fname TYPE string,
          lr_data  TYPE REF TO data.

    lf_fname = if_fname.
    CALL METHOD cl_gui_frontend_services=&gt;gui_upload
      EXPORTING
        filename                = lf_fname
        filetype                = &apos;ASC&apos;
                                              &quot;has_field_separator     = abap_true
        codepage                = if_codepage &quot;&apos;1404&apos;
      CHANGING
        data_tab                = et_data
      EXCEPTIONS
        file_open_error         = 1
        file_read_error         = 2
        no_batch                = 3
        gui_refuse_filetransfer = 4
        invalid_type            = 5
        no_authority            = 6
        unknown_error           = 7
        bad_data_format         = 8
        header_not_allowed      = 9
        separator_not_allowed   = 10
        header_too_long         = 11
        unknown_dp_error        = 12
        access_denied           = 13
        dp_out_of_memory        = 14
        disk_full               = 15
        dp_timeout              = 16
        not_supported_by_gui    = 17
        error_no_gui            = 18
        OTHERS                  = 19.

    delimit_tab( EXPORTING it_data = et_data
                           if_delimiter = if_delimiter
                 IMPORTING et_data = et_data ).
  ENDMETHOD.                    &quot;READ_PC</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS" VERSION="1" LANGU="E" DESCRIPT="Reads data from excel file to internal table from PC" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS" SCONAME="IM_FNAME" VERSION="1" LANGU="E" DESCRIPT="Local file for upload/download" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="LOCALFILE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS" SCONAME="IM_CONVERSION" VERSION="1" LANGU="E" DESCRIPT="Checkbox" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XFELD"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS" SCONAME="ET_TABLE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD read_pc_xls.
    CALL METHOD zcl_file_util=&gt;read_pc_xls2
      EXPORTING
        im_fname      = im_fname
        im_conversion = im_conversion
        im_header     = 0
*       im_sheet      = 0
      IMPORTING
        et_table      = et_table
      EXCEPTIONS
        error         = 1
        OTHERS        = 2.
    IF sy-subrc &lt;&gt; 0.
      RAISE error.
    ENDIF.
  ENDMETHOD.                    &quot;READ_PC_XLS</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS1" VERSION="1" LANGU="E" DESCRIPT="Reads data from excel file to internal table from PC" EXPOSURE="2" STATE="1" EDITORDER="17 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS1" SCONAME="IM_FNAME" VERSION="1" LANGU="E" DESCRIPT="Local file for upload/download" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="LOCALFILE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS1" SCONAME="IM_CONVERSION" VERSION="1" LANGU="E" DESCRIPT="Checkbox" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XFELD"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS1" SCONAME="IM_LINE_HEADER" VERSION="1" LANGU="E" DESCRIPT="Character Field Length 1" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR01" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS1" SCONAME="ET_TABLE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS1" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD read_pc_xls1.
*  DATA: lt_raw TYPE truxs_t_text_data,
*        lx_error TYPE REF TO cx_root.
*
*  DATA: lt_comp       TYPE abap_component_tab,
*        ls_comp       TYPE abap_componentdescr,
*        lt_comp_c     TYPE abap_component_tab,
*        ls_comp_c     TYPE abap_componentdescr,
*        lr_table      TYPE REF TO cl_abap_tabledescr,
*        lr_table_c    TYPE REF TO cl_abap_tabledescr,
*        lr_tabline    TYPE REF TO cl_abap_structdescr,
*        lr_tabline_c  TYPE REF TO cl_abap_structdescr,
*        lt_table_c    TYPE REF TO data,
*        lr_elemdescr  TYPE REF TO cl_abap_elemdescr,
*        lf_lenght     TYPE i.
*
*  FIELD-SYMBOLS: &lt;fs_table_c&gt; TYPE STANDARD TABLE,
*                 &lt;fs_comp_c&gt; TYPE any,
*                 &lt;fs_fld_c&gt; TYPE any,
*                 &lt;fs_comp&gt; TYPE any,
*                 &lt;fs_fld&gt; TYPE any.
*
*  TRY .
*      lr_table ?= cl_abap_tabledescr=&gt;describe_by_data( et_table ).
*      lr_tabline ?= lr_table-&gt;get_table_line_type( ).
*      lt_comp = lr_tabline-&gt;get_components( ).
*
*      LOOP AT lt_comp INTO ls_comp.
*        lr_elemdescr ?= ls_comp-type.
*        CLEAR ls_comp_c.
*        ls_comp_c-name = ls_comp-name.
*        lf_lenght = lr_elemdescr-&gt;output_length.
*        ls_comp_c-type ?= cl_abap_elemdescr=&gt;get_c( lf_lenght ).
*        APPEND ls_comp_c TO lt_comp_c.
*      ENDLOOP.
*
*      lr_tabline_c = cl_abap_structdescr=&gt;create( lt_comp_c ).
*
*      lr_table_c = cl_abap_tabledescr=&gt;create(
*                    p_line_type = lr_tabline_c
*                    p_table_kind = cl_abap_tabledescr=&gt;tablekind_std ).
*
*      CREATE DATA lt_table_c TYPE HANDLE lr_table_c.
*      ASSIGN lt_table_c-&gt;* TO &lt;fs_table_c&gt;.
*
*    CATCH cx_root INTO lx_error.
*      RAISE error.
*  ENDTRY.
*
*  CALL FUNCTION &apos;TEXT_CONVERT_XLS_TO_SAP&apos;
*    EXPORTING
**     I_FIELD_SEPERATOR    =
*      i_line_header        = im_line_header
*      i_tab_raw_data       = lt_raw
*      i_filename           = im_fname
*    TABLES
*      i_tab_converted_data = &lt;fs_table_c&gt;
*    EXCEPTIONS
*      conversion_failed    = 1
*      OTHERS               = 2.
*  IF sy-subrc &lt;&gt; 0.
*    RAISE error.
*  ENDIF.
*
*  TRY .
*      LOOP AT &lt;fs_table_c&gt; ASSIGNING &lt;fs_comp_c&gt;.
*        CLEAR lf_lenght.
*        APPEND INITIAL LINE TO et_table ASSIGNING &lt;fs_comp&gt;.
*        DO.
*          ADD 1 TO lf_lenght.
*          ASSIGN COMPONENT lf_lenght OF STRUCTURE &lt;fs_comp_c&gt; TO &lt;fs_fld_c&gt;.
*          IF sy-subrc NE 0.
*            EXIT.
*          ENDIF.
*          ASSIGN COMPONENT lf_lenght OF STRUCTURE &lt;fs_comp&gt; TO &lt;fs_fld&gt;.
*          IF im_conversion = abap_true.
*            convert_in( EXPORTING if_value = &lt;fs_fld_c&gt;
*                        IMPORTING ef_value = &lt;fs_fld&gt; ).
*          ELSE.
*            &lt;fs_fld&gt; = &lt;fs_fld_c&gt;.
*          ENDIF.
*        ENDDO.
*      ENDLOOP.
*    CATCH cx_root INTO lx_error.
*      RAISE error.
*  ENDTRY.

  ENDMETHOD.                    &quot;READ_PC_XLS1</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS2" VERSION="1" LANGU="E" DESCRIPT="Reads data from excel file to internal table from PC" EXPOSURE="2" STATE="1" EDITORDER="18 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS2" SCONAME="IM_FNAME" VERSION="1" LANGU="E" DESCRIPT="Local file for upload/download" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS2" SCONAME="IM_CONVERSION" VERSION="1" LANGU="E" DESCRIPT="Checkbox" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XFELD" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS2" SCONAME="IM_HEADER" VERSION="1" LANGU="E" DESCRIPT="Skip n header lines" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT1" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS2" SCONAME="IM_SHEET" VERSION="1" LANGU="E" DESCRIPT="name or index" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT1" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS2" SCONAME="ET_TABLE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="READ_PC_XLS2" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD read_pc_xls2.
    DATA: i_begin_col TYPE  i VALUE 1,
          i_begin_row TYPE  i VALUE 1,
          i_end_col TYPE  i  VALUE 200,
          i_end_row TYPE  i VALUE 10000.

    DATA: line(4096) TYPE c.
    DATA: excel_tab     LIKE  TABLE OF line.
    DATA: application   TYPE  ole2_object,
          workbook      TYPE  ole2_object,
          range         TYPE  ole2_object,
          worksheet     TYPE  ole2_object.
    DATA: h_cell        TYPE  ole2_object,
          h_cell1       TYPE  ole2_object.
    DATA:
      ld_rc             TYPE i.
*   Rückgabewert der Methode &quot;clipboard_export     &quot;

* Makro für Fehlerbehandlung der Methods
    DEFINE m_message.
      case sy-subrc.
        when 0.
        when 1.
          message id sy-msgid type &apos;S&apos; number sy-msgno
                  with sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
        when others. &quot;raise upload_ole.
      endcase.
    END-OF-DEFINITION.

* open file in Excel
    IF application-header = space OR application-handle = -1.
      CREATE OBJECT application &apos;Excel.Application&apos;.
      m_message.
    ENDIF.
    CALL METHOD OF
        application
        &apos;Workbooks&apos; = workbook.
    m_message.
    CALL METHOD OF
        workbook&apos;Open&apos;

      EXPORTING
        #1             = im_fname. &quot;filename.
    m_message.
*  set property of application &apos;Visible&apos; = 1.
*  m_message.
    IF im_sheet  &gt; 0.
      CALL METHOD OF
          application
          &apos;Worksheets&apos; = worksheet
        EXPORTING
          #1           = im_sheet.
    ELSE.
      GET PROPERTY OF  application &apos;ACTIVESHEET&apos; = worksheet.
    ENDIF.
    m_message.

    ADD im_header TO i_begin_row.
* mark whole spread sheet
    CALL METHOD OF
        worksheet
        &apos;Cells&apos;   = h_cell
      EXPORTING
        #1        = i_begin_row
        #2        = i_begin_col.
    m_message.
    CALL METHOD OF
        worksheet
        &apos;Cells&apos;   = h_cell1
      EXPORTING
        #1        = i_end_row
        #2        = i_end_col.
    m_message.
    CALL METHOD OF
        worksheet
        &apos;RANGE&apos;   = range
      EXPORTING
        #1        = h_cell
        #2        = h_cell1.
    m_message.
    CALL METHOD OF
        range
        &apos;SELECT&apos;.
    m_message.

* copy marked area (whole spread sheet) into Clippboard
    CALL METHOD OF
        range
        &apos;COPY&apos;.
    m_message.

* read clipboard into ABAP
    CALL METHOD cl_gui_frontend_services=&gt;clipboard_import
      IMPORTING
        data       = excel_tab
      EXCEPTIONS
        cntl_error = 1
        OTHERS     = 4.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE a037(alsmex).
    ENDIF.
* clear clipboard
    CALL METHOD cl_gui_frontend_services=&gt;clipboard_export
      IMPORTING
        data       = excel_tab
      CHANGING
        rc         = ld_rc
      EXCEPTIONS
        cntl_error = 1
        OTHERS     = 4.

*  REFRESH excel_tab.
    REFRESH et_table.
    CALL METHOD zcl_file_util=&gt;delimit_tab
      EXPORTING
        it_data = excel_tab
      IMPORTING
        et_data = et_table
      EXCEPTIONS
        error   = 1
        OTHERS  = 2.
    IF sy-subrc &lt;&gt; 0.
      RAISE error.
* Implement suitable error handling here
    ENDIF.

    CALL METHOD OF
        worksheet
        &apos;Close&apos;.
    m_message.

* quit excel and free abap object - unfortunately, this does not kill
* the Excel process
    CALL METHOD OF
        application
        &apos;QUIT&apos;.
    m_message.

* &gt;&gt;&gt;&gt;&gt; Begin of change note 575877
* to kill the Excel process it&apos;s necessary to free all used objects
    FREE OBJECT h_cell.       m_message.
    FREE OBJECT h_cell1.      m_message.
    FREE OBJECT range.        m_message.
    FREE OBJECT worksheet.    m_message.
    FREE OBJECT workbook.     m_message.
    FREE OBJECT application.  m_message.
* &lt;&lt;&lt;&lt;&lt; End of change note 575877
  ENDMETHOD.                    &quot;READ_PC_XLS2</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_AS" VERSION="1" LANGU="E" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_AS" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_AS" SCONAME="IT_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_AS" SCONAME="IF_CODEPAGE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_ENCODING" PARVALUE="&apos;1404&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_AS" SCONAME="IF_DELIMITER" VERSION="1" LANGU="E" DESCRIPT="Single-Character Flag" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_AS" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD save_as.
    DATA: lf_fname TYPE string,
          lt_data TYPE TABLE OF string,
          ls_text  TYPE string,
          lr_ex    TYPE REF TO cx_root.

    delimit_tab( EXPORTING it_data      = it_data
                           reverse      = space
                           if_delimiter = if_delimiter
                 IMPORTING et_data      = lt_data ).

    lf_fname = if_fname.
    TRY.
        OPEN DATASET if_fname ENCODING DEFAULT FOR OUTPUT IN TEXT MODE.
      CATCH  cx_root INTO lr_ex.
        ls_text = lr_ex-&gt;get_text( ).
        MESSAGE e415(oa) INTO mf_dummy.
        RAISE error.
    ENDTRY.

    IF sy-subrc &lt;&gt; 0.
      MESSAGE e415(oa) INTO mf_dummy.
      RAISE error.
    ENDIF.

    LOOP AT lt_data INTO ls_text.
      TRANSFER ls_text TO lf_fname.
    ENDLOOP.
    CLOSE DATASET lf_fname.
  ENDMETHOD.                    &quot;SAVE_AS</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_PC" VERSION="1" LANGU="E" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_PC" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_PC" SCONAME="IT_DATA" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_PC" SCONAME="IF_CODEPAGE" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_ENCODING" PARVALUE="&apos;1404&apos;"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_PC" SCONAME="IF_DELIMITER" VERSION="1" LANGU="E" DESCRIPT="Single-Character Flag" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_PC" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140227" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD save_pc.
    DATA: lf_fname TYPE string,
          lt_data TYPE TABLE OF string.

    delimit_tab( EXPORTING it_data      = it_data
                           reverse      = space
                           if_delimiter = if_delimiter
                 IMPORTING et_data      = lt_data ).

    lf_fname = if_fname.
    CALL METHOD cl_gui_frontend_services=&gt;gui_download
      EXPORTING
        filename = lf_fname
        filetype = &apos;ASC&apos;
        codepage = if_codepage
      CHANGING
        data_tab = lt_data
      EXCEPTIONS
        OTHERS   = 24.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
                 WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4 RAISING error.
    ENDIF.


  ENDMETHOD.                    &quot;SAVE_PC</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_AS" VERSION="1" LANGU="E" DESCRIPT="Zip data to application server" EXPOSURE="2" STATE="1" EDITORDER="19 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_AS" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_AS" SCONAME="EF_XSTR" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140429" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_AS" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD save_zip_as.
    DATA: lt_bin TYPE solix_tab.
    FIELD-SYMBOLS: &lt;bin&gt; LIKE LINE OF lt_bin.

    ef_xstr = mr_zip-&gt;save( ).
    CALL FUNCTION &apos;SCMS_XSTRING_TO_BINARY&apos;
      EXPORTING
        buffer                = ef_xstr
*     APPEND_TO_TABLE       = &apos; &apos;
*   IMPORTING
*     OUTPUT_LENGTH         =
      TABLES
        binary_tab            = lt_bin.
    TRY.
        OPEN DATASET if_fname FOR OUTPUT IN BINARY MODE.
      CATCH cx_root.
        MESSAGE e415(oa) WITH if_fname RAISING error.
    ENDTRY.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE e415(oa) WITH if_fname RAISING error.
    ENDIF.
    LOOP AT lt_bin ASSIGNING &lt;bin&gt;.
      TRANSFER &lt;bin&gt; TO if_fname.
    ENDLOOP.
    CLOSE DATASET if_fname.
  ENDMETHOD.                    &quot;save_zip_as</source>
 </method>
 <method CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_PC" VERSION="1" LANGU="E" DESCRIPT="Zip data to application server" EXPOSURE="2" STATE="1" EDITORDER="20 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_PC" SCONAME="IF_FNAME" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CSEQUENCE"/>
  <parameter CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_PC" SCONAME="EF_XSTR" VERSION="1" LANGU="E" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " AUTHOR="RIGERD" CREATEDON="20140429" CHANGEDBY="RIGERD" CHANGEDON="20140429" PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING"/>
  <exception CLSNAME="ZCL_FILE_UTIL" CMPNAME="SAVE_ZIP_PC" SCONAME="ERROR" VERSION="1" LANGU="E" MTDTYPE="0" EDITORDER="1 " AUTHOR="RIGERD" CREATEDON="20140416" CHANGEDBY="RIGERD" CHANGEDON="20140429"/>
  <source>METHOD save_zip_pc.
    DATA: lf_str TYPE string,
          lf_siz TYPE i,
          lt_bin TYPE solix_tab.
    FIELD-SYMBOLS: &lt;bin&gt; LIKE LINE OF lt_bin.

    ef_xstr = mr_zip-&gt;save( ).
    CALL FUNCTION &apos;SCMS_XSTRING_TO_BINARY&apos;
      EXPORTING
        buffer          = ef_xstr
*       APPEND_TO_TABLE = &apos; &apos;
      IMPORTING
        output_length   = lf_siz
      TABLES
        binary_tab      = lt_bin.

*   Download the Zip file
    lf_str = if_fname.
    cl_gui_frontend_services=&gt;gui_download(
      EXPORTING
        bin_filesize              = lf_siz
        filename                  = lf_str
        filetype                  = &apos;BIN&apos;
*      IMPORTING
*        filelength                = y_filesize
      CHANGING
        data_tab                  = lt_bin
      EXCEPTIONS
        file_write_error          = 1
        no_batch                  = 2
        gui_refuse_filetransfer   = 3
        invalid_type              = 4
        no_authority              = 5
        unknown_error             = 6
        header_not_allowed        = 7
        separator_not_allowed     = 8
        filesize_not_allowed      = 9
        header_too_long           = 10
        dp_error_create           = 11
        dp_error_send             = 12
        dp_error_write            = 13
        unknown_dp_error          = 14
        access_denied             = 15
        dp_out_of_memory          = 16
        disk_full                 = 17
        dp_timeout                = 18
        file_not_found            = 19
        dataprovider_exception    = 20
        control_flush_error       = 21
        not_supported_by_gui      = 22
        error_no_gui              = 23
        OTHERS                    = 24 ).
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
               WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4 RAISING error.
    ENDIF.
  ENDMETHOD.                    &quot;save_zip_pc</source>
 </method>
</CLAS>
